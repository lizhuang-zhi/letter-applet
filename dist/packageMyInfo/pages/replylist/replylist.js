let requestData=require("../../../utils/request");Page({data:{replyList:[]},clickEvent(e){let n=e.currentTarget.dataset.letterid,o=e.currentTarget.dataset.senderopenid;var t=e.currentTarget.dataset.recipientpenname,a=e.currentTarget.dataset.senderpenname,e=e.currentTarget.dataset.replyid;wx.getStorage({key:"unReadLetterList",success:e=>{let a=e.data;a.forEach((e,t)=>{e.letterId==n&&e.sender==o&&a.splice(t,1)}),wx.setStorage({key:"unReadLetterList",data:a})},fail:e=>{console.log(e)}}),wx.navigateTo({url:"/packageMyInfo/pages/replyletter/replyletter?letterId="+n+"&senderOpenId="+o+"&recipientPenName="+t+"&senderPenName="+a+"&replyId="+e})},tapAllRead(){let t=this;wx.removeStorage({key:"unReadLetterList",success(e){console.log(e),wx.showToast({title:"全部已读，可在历史信息中再次查看",icon:"none"}),t.setData({replyList:[]})}})},Start(e){requestData.replylist(e).then(e=>{console.log(e.data.data);let a=e.data.data,n=null;new Promise((t,e)=>{wx.getStorage({key:"unReadLetterList",success:e=>{n=e.data,console.log(n),t("success")},fail:e=>{n=null,console.log(n),t("error")}})}).then(e=>{console.log(e);let t=n;null!=a&&(a.forEach(e=>{e.isRead=!1}),t=null==t?a:a.concat(t),wx.setStorage({key:"unReadLetterList",data:t})),this.setData({replyList:t})})})},onLoad:function(e){this.Start(e.openId),console.log("replylist ---- 监听页面加载")},onReady:function(){},onShow:function(){console.log("replylist页面 -- 监听页面显示"),wx.getStorage({key:"unReadLetterList",success:e=>{e=e.data;this.setData({replyList:e})},fail:e=>{console.log(e)}})},onHide:function(){console.log("----- 监听页面隐藏 ------")},onUnload:function(){console.log("replylist页面 ----- 监听页面卸载 ------")},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){}});