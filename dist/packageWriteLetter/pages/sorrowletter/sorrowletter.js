let requestData=require("../../../utils/request"),requestLetterline=require("../../../utils/public"),timeTools=require("../../../utils/timeTools"),app=getApp();Page({data:{LastTimes:1,TimesFontSize:"32rpx",TiemsColor:"grey",letterInfo:{},letterId:""},replyLetter(){wx.getStorage({key:"userBackLetterNum",success:e=>{var t;console.log(e.data),1==e.data.letterBackNum?(t=this.data.letterId,e=this.data.senderOpenId,wx.navigateTo({url:"/packageReleaseModule/pages/attention/attention?type=解答&letterId="+t+"&senderOpenId="+e})):wx.showToast({title:"今日已没有解答次数~",icon:"none"})}})},Start(e){wx.showLoading({title:"加载中.."});var t=app.globalData.openid;requestData.sorrowletter(e,t).then(o=>new Promise((e,t)=>{console.log(o.data.data);let a=o.data.data;a.releaseTime=timeTools.squareDiaryTime(a.releaseTime),a.content=a.content.split("\n"),this.setData({letterInfo:a}),e("success")})).then(e=>{wx.hideLoading({})})},onLoad:function(e){console.log("sorrowletter页面 ----------- 监听页面加载"),this.setData({letterId:e.id,senderOpenId:e.senderOpenId}),wx.getStorage({key:"userBackLetterNum",success:e=>{this.setData({LastTimes:e.data.letterBackNum})}}),this.Start(e.id)},onReady:function(){},onShow:function(){console.log("sorrowletter页面 ----------- 监听页面显示"),wx.getStorage({key:"userBackLetterNum",success:e=>{var t=new Date(e.data.judgeTime).getTime();1!=e.data.letterBackNum&&(e=(new Date).getTime(),console.log(new Date(t)),t<e&&(console.log("-- 重刷新解答次数 --"),wx.setStorage({key:"userBackLetterNum",data:{letterBackNum:1,judgeTime:new Date}}),this.setData({LastTimes:1})))}})},onHide:function(){},onUnload:function(){console.log("sorrowletter页面 ---\x3e 监听页面卸载")},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){}});