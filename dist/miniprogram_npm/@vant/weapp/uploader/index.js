"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,i=1,a=arguments.length;i<a;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0});var component_1=require("../common/component"),utils_1=require("./utils"),shared_1=require("./shared");component_1.VantComponent({props:__assign(__assign({disabled:Boolean,multiple:Boolean,uploadText:String,useBeforeRead:Boolean,afterRead:null,beforeRead:null,previewSize:{type:null,value:80},name:{type:[Number,String],value:""},accept:{type:String,value:"image"},fileList:{type:Array,value:[],observer:"formatFileList"},maxSize:{type:Number,value:Number.MAX_VALUE},maxCount:{type:Number,value:100},deletable:{type:Boolean,value:!0},showUpload:{type:Boolean,value:!0},previewImage:{type:Boolean,value:!0},previewFullImage:{type:Boolean,value:!0},imageFit:{type:String,value:"scaleToFill"},uploadIcon:{type:String,value:"photograph"}},shared_1.chooseImageProps),shared_1.chooseVideoProps),data:{lists:[],isInCount:!0},methods:{formatFileList:function(){var e=this.data,t=e.fileList,t=void 0===t?[]:t,e=e.maxCount,t=t.map(function(e){return __assign(__assign({},e),{isImage:void 0===e.isImage?utils_1.isImageFile(e):e.isImage,deletable:void 0===e.deletable||e.deletable})});this.setData({lists:t,isInCount:t.length<e})},getDetail:function(e){return{name:this.data.name,index:null==e?this.data.fileList.length:e}},startUpload:function(){var i=this,e=this.data,t=e.maxCount,a=e.multiple,s=e.accept,n=e.lists;e.disabled||utils_1.chooseFile(__assign(__assign({},this.data),{maxCount:t-n.length})).then(function(e){var t=null,t=utils_1.isVideo(e,s)?__assign({path:e.tempFilePath},e):a?e.tempFiles:e.tempFiles[0];i.onBeforeRead(t)}).catch(function(e){i.$emit("error",e)})},onBeforeRead:function(a){var s=this,e=this.data,t=e.beforeRead,i=e.useBeforeRead,e=!0;"function"==typeof t&&(e=t(a,this.getDetail())),(e=i?new Promise(function(t,i){s.$emit("before-read",__assign(__assign({file:a},s.getDetail()),{callback:function(e){(e?t:i)()}}))}):e)&&(utils_1.isPromise(e)?e.then(function(e){return s.onAfterRead(e||a)}):this.onAfterRead(a))},onAfterRead:function(e){var t=this.data.maxSize;(Array.isArray(e)?e.some(function(e){return e.size>t}):e.size>t)?this.$emit("oversize",__assign({file:e},this.getDetail())):("function"==typeof this.data.afterRead&&this.data.afterRead(e,this.getDetail()),this.$emit("after-read",__assign({file:e},this.getDetail())))},deleteItem:function(e){e=e.currentTarget.dataset.index;this.$emit("delete",__assign(__assign({},this.getDetail(e)),{file:this.data.fileList[e]}))},onPreviewImage:function(e){var t;this.data.previewFullImage&&(t=e.currentTarget.dataset.index,t=(e=this.data.lists)[t],wx.previewImage({urls:e.filter(function(e){return e.isImage}).map(function(e){return e.url||e.path}),current:t.url||t.path,fail:function(){wx.showToast({title:"预览图片失败",icon:"none"})}}))},onClickPreview:function(e){var t=e.currentTarget.dataset.index,e=this.data.lists[t];this.$emit("click-preview",__assign(__assign({},e),this.getDetail(t)))}}});