"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var component_1=require("../common/component"),touch_1=require("../mixins/touch"),utils_1=require("../common/utils");component_1.VantComponent({mixins:[touch_1.touch],classes:["nav-class","tab-class","tab-active-class","line-class"],relation:{name:"tab",type:"descendant",current:"tabs",linked:function(t){t.index=this.children.length-1,this.updateTabs()},unlinked:function(){this.children=this.children.map(function(t,e){return t.index=e,t}),this.updateTabs()}},props:{color:{type:String,observer:"setLine"},sticky:Boolean,animated:{type:Boolean,observer:function(){var n=this;this.children.forEach(function(t,e){return t.updateRender(e===n.data.currentIndex,n)})}},swipeable:Boolean,lineWidth:{type:[String,Number],value:-1,observer:"setLine"},lineHeight:{type:[String,Number],value:-1,observer:"setLine"},titleActiveColor:String,titleInactiveColor:String,active:{type:[String,Number],value:0,observer:function(t){t!==this.getCurrentName()&&this.setCurrentIndexByName(t)}},type:{type:String,value:"line"},border:{type:Boolean,value:!0},ellipsis:{type:Boolean,value:!0},duration:{type:Number,value:.3},zIndex:{type:Number,value:1},swipeThreshold:{type:Number,value:4,observer:function(t){this.setData({scrollable:this.children.length>t||!this.data.ellipsis})}},offsetTop:{type:Number,value:0},lazyRender:{type:Boolean,value:!0}},data:{tabs:[],lineStyle:"",scrollLeft:0,scrollable:!1,trackStyle:"",currentIndex:null,container:null},mounted:function(){var t=this;wx.nextTick(function(){t.setLine(!0),t.scrollIntoView()})},methods:{updateContainer:function(){var t=this;this.setData({container:function(){return t.createSelectorQuery().select(".van-tabs")}})},updateTabs:function(){var t=this.children,e=this.data;this.setData({tabs:(void 0===t?[]:t).map(function(t){return t.data}),scrollable:this.children.length>e.swipeThreshold||!e.ellipsis}),this.setCurrentIndexByName(this.getCurrentName()||e.active)},trigger:function(t,e){var n=this.data.currentIndex,n=e||this.children[n];utils_1.isDef(n)&&this.$emit(t,{index:n.index,name:n.getComputedName(),title:n.data.title})},onTap:function(t){var e=this,n=t.currentTarget.dataset.index,t=this.children[n];t.data.disabled?this.trigger("disabled",t):(this.setCurrentIndex(n),wx.nextTick(function(){e.trigger("click")}))},setCurrentIndexByName:function(e){var t=this.children,t=(void 0===t?[]:t).filter(function(t){return t.getComputedName()===e});t.length&&this.setCurrentIndex(t[0].index)},setCurrentIndex:function(n){var t,i=this,e=this.data,r=this.children,r=void 0===r?[]:r;!utils_1.isDef(n)||n>=r.length||n<0||(r.forEach(function(t,e){e=e===n;e===t.data.active&&t.inited||t.updateRender(e,i)}),n!==e.currentIndex&&(t=null!==e.currentIndex,this.setData({currentIndex:n}),wx.nextTick(function(){i.setLine(),i.scrollIntoView(),i.updateContainer(),i.trigger("input"),t&&i.trigger("change")})))},getCurrentName:function(){var t=this.children[this.data.currentIndex];if(t)return t.getComputedName()},setLine:function(r){var t,a,s,o,l,u,c=this;"line"===this.data.type&&(t=this.data,a=t.color,s=t.duration,o=t.currentIndex,l=t.lineWidth,u=t.lineHeight,this.getRect(".van-tab",!0).then(function(t){var e,n,i=(t=void 0===t?[]:t)[o];null!=i&&(e=-1!==l?l:i.width/2,n=-1!==u?"height: "+utils_1.addUnit(u)+"; border-radius: "+utils_1.addUnit(u)+";":"",t=t.slice(0,o).reduce(function(t,e){return t+e.width},0),t+=(i.width-e)/2,i=r?"":"transition-duration: "+s+"s; -webkit-transition-duration: "+s+"s;",c.setData({lineStyle:"\n            "+n+"\n            width: "+utils_1.addUnit(e)+";\n            background-color: "+a+";\n            -webkit-transform: translateX("+t+"px);\n            transform: translateX("+t+"px);\n            "+i+"\n          "}))}))},scrollIntoView:function(){var i=this,t=this.data,r=t.currentIndex;t.scrollable&&Promise.all([this.getRect(".van-tab",!0),this.getRect(".van-tabs__nav")]).then(function(t){var e=t[0],n=t[1],t=e[r],e=e.slice(0,r).reduce(function(t,e){return t+e.width},0);i.setData({scrollLeft:e-(n.width-t.width)/2})})},onTouchScroll:function(t){this.$emit("scroll",t.detail)},onTouchStart:function(t){this.data.swipeable&&this.touchStart(t)},onTouchMove:function(t){this.data.swipeable&&this.touchMove(t)},onTouchEnd:function(){var t,e,n,i,r;this.data.swipeable&&(t=(r=this.data).tabs,e=r.currentIndex,n=this.direction,i=this.deltaX,r=this.offsetX,"horizontal"===n&&50<=r&&(0<i&&0!==e?this.setCurrentIndex(e-1):i<0&&e!==t.length-1&&this.setCurrentIndex(e+1)))}}});