"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0});var component_1=require("../common/component"),shared_1=require("../picker/shared"),COLUMNSPLACEHOLDERCODE="000000";component_1.VantComponent({classes:["active-class","toolbar-class","column-class"],props:__assign(__assign({},shared_1.pickerProps),{value:{type:String,observer:function(e){this.code=e,this.setValues()}},areaList:{type:Object,value:{},observer:"setValues"},columnsNum:{type:null,value:3,observer:function(e){this.setData({displayColumns:this.data.columns.slice(0,+e)})}},columnsPlaceholder:{type:Array,observer:function(e){this.setData({typeToColumnsPlaceholder:{province:e[0]||"",city:e[1]||"",county:e[2]||""}})}}}),data:{columns:[{values:[]},{values:[]},{values:[]}],displayColumns:[{values:[]},{values:[]},{values:[]}],typeToColumnsPlaceholder:{}},mounted:function(){var e=this;setTimeout(function(){e.setValues()},0)},methods:{getPicker:function(){return null==this.picker&&(this.picker=this.selectComponent(".van-area__picker")),this.picker},onCancel:function(e){this.emit("cancel",e.detail)},onConfirm:function(e){var t=e.detail.index,e=e.detail.value,e=this.parseOutputValues(e);this.emit("confirm",{value:e,index:t})},emit:function(e,t){t.values=t.value,delete t.value,this.$emit(e,t)},parseOutputValues:function(e){var n=this.data.columnsPlaceholder;return e.map(function(e,t){return e&&((e=JSON.parse(JSON.stringify(e))).code&&e.name!==n[t]||(e.code="",e.name=""),e)})},onChange:function(e){var t=this,e=e.detail,n=e.index,s=e.picker,e=e.value;this.code=e[n].code,this.setValues().then(function(){t.$emit("change",{picker:s,values:t.parseOutputValues(s.getValues()),index:n})})},getConfig:function(e){var t=this.data.areaList;return t&&t[e+"_list"]||{}},getList:function(e,t){var n=this.data.typeToColumnsPlaceholder,s=[];if("province"!==e&&!t)return s;var i,c=this.getConfig(e),s=Object.keys(c).map(function(e){return{code:e,name:c[e]}});return t&&("9"===t[0]&&"city"===e&&(t="9"),s=s.filter(function(e){return 0===e.code.indexOf(t)})),n[e]&&s.length&&(i="province"===e?"":"city"===e?COLUMNSPLACEHOLDERCODE.slice(2,4):COLUMNSPLACEHOLDERCODE.slice(4,6),s.unshift({code:""+t+i,name:n[e]})),s},getIndex:function(e,t){var n="province"===e?2:"city"===e?4:6,s=this.getList(e,t.slice(0,n-2));"9"===t[0]&&"province"===e&&(n=1),t=t.slice(0,n);for(var i=0;i<s.length;i++)if(s[i].code.slice(0,n)===t)return i;return 0},setValues:function(){var e=this.getConfig("county"),t=(t=this.code)||(this.data.columnsPlaceholder.length?COLUMNSPLACEHOLDERCODE:Object.keys(e)[0]?Object.keys(e)[0]:""),n=this.getList("province"),s=this.getList("city",t.slice(0,2)),i=this.getPicker();if(i){var e=[],c=[];return 1<=this.data.columnsNum&&(e.push(i.setColumnValues(0,n,!1)),c.push(this.getIndex("province",t))),2<=this.data.columnsNum&&(e.push(i.setColumnValues(1,s,!1)),c.push(this.getIndex("province",t)),s.length&&"00"===t.slice(2,4)&&(t=s[0].code)),3===this.data.columnsNum&&e.push(i.setColumnValues(2,this.getList("county",t.slice(0,4)),!1)),Promise.all(e).catch(function(){}).then(function(){return i.setIndexes(c)}).catch(function(){})}},getValues:function(){var e=this.getPicker();return e?e.getValues().filter(function(e){return!!e}):[]},getDetail:function(){var e=this.getValues(),t={code:"",country:"",province:"",city:"",county:""};if(!e.length)return t;var n=e.map(function(e){return e.name});return t.code=e[e.length-1].code,"9"===t.code[0]?(t.country=n[1]||"",t.province=n[2]||""):(t.province=n[0]||"",t.city=n[1]||"",t.county=n[2]||""),t},reset:function(e){return this.code=e||"",this.setValues()}}});