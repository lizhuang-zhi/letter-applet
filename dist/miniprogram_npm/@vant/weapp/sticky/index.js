"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var component_1=require("../common/component"),page_scroll_1=require("../mixins/page-scroll"),ROOT_ELEMENT=".van-sticky";component_1.VantComponent({props:{zIndex:{type:Number,value:99},offsetTop:{type:Number,value:0,observer:"onScroll"},disabled:{type:Boolean,observer:"onScroll"},container:{type:null,observer:"onScroll"},scrollTop:{type:null,observer:function(t){this.onScroll({scrollTop:t})}}},mixins:[page_scroll_1.pageScrollMixin(function(t){null==this.data.scrollTop&&this.onScroll(t)})],data:{height:0,fixed:!1,transform:0},mounted:function(){this.onScroll()},methods:{onScroll:function(t){var o=this,e=(void 0===t?{}:t).scrollTop,i=this.data,t=i.container,n=i.offsetTop;i.disabled?this.setDataAfterDiff({fixed:!1,transform:0}):(this.scrollTop=e||this.scrollTop,"function"!=typeof t?this.getRect(ROOT_ELEMENT).then(function(t){n>=t.top?(o.setDataAfterDiff({fixed:!0,height:t.height}),o.transform=0):o.setDataAfterDiff({fixed:!1})}):Promise.all([this.getRect(ROOT_ELEMENT),this.getContainerRect()]).then(function(t){var e=t[0],t=t[1];n+e.height>t.height+t.top?o.setDataAfterDiff({fixed:!1,transform:t.height-e.height}):n>=e.top?o.setDataAfterDiff({fixed:!0,height:e.height,transform:0}):o.setDataAfterDiff({fixed:!1,transform:0})}))},setDataAfterDiff:function(o){var i=this;wx.nextTick(function(){var t=Object.keys(o).reduce(function(t,e){return o[e]!==i.data[e]&&(t[e]=o[e]),t},{});i.setData(t),i.$emit("scroll",{scrollTop:i.scrollTop,isFixed:o.fixed||i.data.fixed})})},getContainerRect:function(){var e=this.data.container();return new Promise(function(t){return e.boundingClientRect(t).exec()})}}});